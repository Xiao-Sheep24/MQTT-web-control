<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <title>ESP32 LED æ§åˆ¶é¢æ¿</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
    <h1>ESP32 LED æ§åˆ¶é¢æ¿</h1>
    <button onclick="sendMessage('1')">LED ON</button>
    <button onclick="sendMessage('0')">LED OFF</button>
    <button onclick="sendMessage('Hi')">ç™¼é€ Hi</button>
    <div id="status"></div>

    <script>
        // åˆå§‹åŒ– MQTT é€£æ¥
        const client = mqtt.connect('wss://broker.emqx.io:8084/mqtt', {
            clientId: 'web_client_1',
            username: 'mqttx_ce657d5d',
            password: ''
        });

        client.on('connect', () => {
            console.log('âœ… å·²é€£æ¥åˆ° MQTT Broker');
            document.getElementById('status').innerHTML = 'âœ… å·²é€£æ¥åˆ° MQTT Broker';
            client.subscribe('home/yard/ESP32', { qos: 1 });
        });

        client.on('message', (topic, message) => {
            console.log('ğŸ“¥ æ”¶åˆ°è¨Šæ¯:', message.toString());
            document.getElementById('status').innerHTML = 'ğŸ“¥ æ”¶åˆ°è¨Šæ¯: ' + message.toString();
        });

        client.on('error', (error) => {
            console.error('âŒ é€£æ¥éŒ¯èª¤:', error);
            document.getElementById('status').innerHTML = 'âŒ é€£æ¥éŒ¯èª¤: ' + error;
        });

        function sendMessage(msg) {
            const payload = JSON.stringify({
                msg: msg,
                sender: 'web_client_1'
            });
            client.publish('home/yard/ESP32', payload, { qos: 1 });
            console.log('ğŸš€ å·²ç™¼é€è¨Šæ¯:', payload);
            document.getElementById('status').innerHTML = 'ğŸš€ å·²ç™¼é€è¨Šæ¯: ' + payload;
        }
    </script>
</body>
</html>
